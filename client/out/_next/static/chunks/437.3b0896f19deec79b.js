"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[437],{437:function(e,t,a){a.r(t);var s=a(5893),n=a(1701),r=a(7294),l=a(9583),c=a(5434),i=a(1796),o=a.n(i),d=a(6154),u=a(58),p=a(9149);t.default=function(e){let{hide:t}=e,[{userInfo:a,currentChatUser:i,socket:m},f]=(0,n.C4)(),[h,x]=(0,r.useState)(!1),[g,v]=(0,r.useState)(null),[j,S]=(0,r.useState)(null),[w,N]=(0,r.useState)(0),[C,E]=(0,r.useState)(0),[b,k]=(0,r.useState)(0),[y,L]=(0,r.useState)(!1),[R,M]=(0,r.useState)(null),D=(0,r.useRef)(null),_=(0,r.useRef)(null),U=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e;return h&&(e=setInterval(()=>{N(e=>(k(e+1),e+1))},1e3)),()=>{clearInterval(e)}},[h]),(0,r.useEffect)(()=>{let e=o().create({container:U.current,waveColor:"#ccc",progressColor:"#4a9eff",cursorColor:"#7ae3c3",barWidth:2,height:30,responsive:!0});return S(e),e.on("finish",()=>{L(!1)}),()=>{e.destroy()}},[]),(0,r.useEffect)(()=>{j&&A()},[j]);let A=()=>{N(0),E(0),k(0),x(!0),v(null),navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{let t=new MediaRecorder(e);_.current=t,D.current.srcObject=e;let a=[];t.ondataavailable=e=>a.push(e.data),t.onstop=()=>{let e=new Blob(a,{type:"audio/ogg; codecs=opus"}),t=URL.createObjectURL(e),s=new Audio(t);v(s),j.load(t)},t.start()}).catch(e=>{console.log("Error accessing micophone:",e)})};(0,r.useEffect)(()=>{if(g){let e=()=>{E(g.currentTime)};return g.addEventListener("timeUpdate",e),()=>{g.removeEventListener("timeupdate",e)}}},[g]);let F=async()=>{try{let e=new FormData;e.append("audio",R);let t=await d.Z.post(u.OZ,e,{headers:{"Content-Type":"multipart/form-data"},params:{from:a.id,to:i.id}});201===t.status&&(m.current.emit("send-msg",{to:null==i?void 0:i.id,from:null==a?void 0:a.id,message:t.data.message}),f({type:p.J.ADD_MESSAGE,newMessage:{...t.data.message},fromSelf:!0}))}catch(e){console.log(e)}},G=e=>isNaN(e)?"00:00":"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat(Math.floor(e%60).toString().padStart(2,"0"));return(0,s.jsxs)("div",{className:"flex text-2xl w-full justify-end items-center",children:[(0,s.jsx)("div",{className:"pt-1",children:(0,s.jsx)(l.Xm5,{className:"text-panel-header-icon",onClick:()=>t()})}),(0,s.jsxs)("div",{className:"mx-4 px-4 text-white text-lg flex gap-3 justify-center items-center bg-search-input-container-background rounded-full drop-shadow-lg",children:[h?(0,s.jsxs)("div",{className:"text-red-500 animate-pulse z-60 text-center",children:["Recording ",(0,s.jsxs)("span",{children:[w,"s"]})]}):(0,s.jsx)("div",{children:g&&(0,s.jsx)(s.Fragment,{children:y?(0,s.jsx)(l.JuG,{onClick:()=>{j.stop(),g.pause(),L(!1)}}):(0,s.jsx)(l.gmG,{onClick:()=>{g&&(j.stop(),j.play(),g.play(),L(!0))}})})}),(0,s.jsx)("div",{className:"w-60",ref:U,hidden:h}),g&&y&&(0,s.jsx)("span",{children:G(C)}),g&&!y&&(0,s.jsx)("span",{children:G(b)}),(0,s.jsx)("audio",{ref:D,hidden:!0})]}),(0,s.jsx)("div",{className:"mr-4",children:h?(0,s.jsx)(l.x00,{className:"text-red-500",onClick:()=>{if(_.current&&h){_.current.stop(),x(!1),j.stop();let e=[];_.current.addEventListener("dataavailable",t=>{e.push(t.data)}),_.current.addEventListener("stop",()=>{let t=new Blob(e,{type:"audio/mp3"}),a=new File([t],"recording.mp3");M(a)})}}}):(0,s.jsx)(l.uYL,{className:"text-red-500",onClick:A})}),(0,s.jsx)("div",{children:(0,s.jsx)(c.D6S,{className:"text-panel-header-icon cursor-pointer mr-4 ",title:"Send",onClick:F})})]})}}}]);