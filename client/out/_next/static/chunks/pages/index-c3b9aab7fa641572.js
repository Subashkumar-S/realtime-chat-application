(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5728:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(812)}])},9352:function(e,t,s){"use strict";s.d(t,{Z:function(){return m}});var a=s(5893),n=s(7294),l=s(5675),r=s.n(l),c=s(9583),i=s(9413),o=s(6223),d=s(155),u=function(e){let{setImage:t,hidePhotoLibrary:s}=e;return(0,a.jsx)("div",{className:"fixed top-0 left-0 max-h-[100vh] max-w-[100vw] w-full h-full flex justify-center items-center",children:(0,a.jsxs)("div",{className:"h-max w-max bg-gray-900 gap-6 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"pt-2 pe-2 cursor-pointer flex items-end justify-end",onClick:()=>s(!1),children:(0,a.jsx)(d.bjh,{className:"h-10 w-10 cursor-pointer"})}),(0,a.jsx)("div",{className:"grid grid-cols-3 justify-center items-center gap-16 p-20 w-full",children:["/avatars/1.png","/avatars/2.png","/avatars/3.png","/avatars/4.png","/avatars/5.png","/avatars/6.png","/avatars/7.png","/avatars/8.png","/avatars/9.png"].map((e,n)=>(0,a.jsx)("div",{onClick:()=>{t(e),s(!1)},children:(0,a.jsx)("div",{className:" h-24 w-24 cursor-pointer relative",children:(0,a.jsx)(r(),{src:e,alt:"avatar",fill:!0})})},n))})]})})},x=function(e){let{hide:t,setImage:s}=e,l=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e;let t=async()=>{e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),l.current.srcObject=e};return t(),()=>{var t;null===(t=e)||void 0===t||t.getTracks().forEach(e=>e.stop())}},[]),(0,a.jsx)("div",{className:"absolute h-4/6 w-2/6 top-1/4 left-1/3 bg-gray-900 gap-3 rounded-lg flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 w-full items-center justify-center",children:[(0,a.jsx)("div",{className:"pt-2 pr-2 cursor-pointer flex items-end justify-end",onClick:()=>t(!1),children:(0,a.jsx)(d.bjh,{className:"h-10 w-10 cursor-pointer"})}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("video",{id:"video",width:"400",autoPlay:!0,ref:l})}),(0,a.jsx)("button",{className:"h-16 w-16 bg-white rounded-full cursor-pointer border-8 border-teal-light p-2 mb-10",onClick:()=>{let e=document.createElement("canvas");e.getContext("2d").drawImage(l.current,0,0,300,150),s(e.toDataURL("image/jpeg")),t(!1)}})]})})},m=function(e){let{type:t,image:s,setImage:l}=e,[d,m]=(0,n.useState)(!1),[p,f]=(0,n.useState)(!1),[h,g]=(0,n.useState)({x:0,y:0}),[j,v]=(0,n.useState)(!1),[N,b]=(0,n.useState)(!1),[y,w]=(0,n.useState)(!1),C=e=>{e.preventDefault(),g({x:e.pageX,y:e.pageY}),f(!0)};(0,n.useEffect)(()=>{if(j){let e=document.getElementById("photo-picker");e.click(),document.body.onfocus=e=>{setTimeout(()=>{v(!1)},1e3)}}},[j]);let E=async e=>{let t=e.target.files[0],s=new FileReader,a=document.createElement("img");s.onload=function(e){a.src=e.target.result,a.setAttribute("data-src",e.target.result)},s.readAsDataURL(t),setTimeout(()=>{l(a.src)},100)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-center",children:["sm"===t&&(0,a.jsx)("div",{className:"relative h-10 w-10",children:(0,a.jsx)(r(),{src:s,alt:"avatar",className:"rounded-full",fill:!0})}),"lg"===t&&(0,a.jsx)("div",{className:"relative h-14 w-14",children:(0,a.jsx)(r(),{src:s,alt:"avatar",className:"rounded-full",fill:!0})}),"xl"===t&&(0,a.jsxs)("div",{className:"relative cursor-pointer z-0",onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[(0,a.jsxs)("div",{className:"z-10 bg-photopicker-overlay-background h-60 w-60 absolute top-0 left-0 flex items-center rounded-full justify-center flex-col text-center gap-2 ".concat(d?"visible":"hidden"),onClick:e=>C(e),id:"context-opener",children:[(0,a.jsx)(c.Dmm,{className:"text-2xl",id:"context-opener",onClick:e=>C(e)}),(0,a.jsxs)("span",{onClick:e=>C(e),id:"context-opener",children:["Change ",(0,a.jsx)("br",{})," Profile ",(0,a.jsx)("br",{})," Photo"]})]}),(0,a.jsx)("div",{className:" h-60 w-60 ",children:(0,a.jsx)(r(),{src:s,alt:"avatar",className:"rounded-full",fill:!0})})]})]}),p&&(0,a.jsx)(i.Z,{options:[{name:"Take photo",callback:()=>{w(!0)}},{name:"Choose from library",callback:()=>{b(!0)}},{name:"Upload photo",callback:()=>{v(!0)}},{name:"Remove photo",callback:()=>{l("/default_avatar.png")}}],coordinates:h,contextMenu:p,setContextMenu:f}),y&&(0,a.jsx)(x,{setImage:l,hide:w}),N&&(0,a.jsx)(u,{setImage:l,hidePhotoLibrary:b}),j&&(0,a.jsx)(o.Z,{onChange:E})]})}},9413:function(e,t,s){"use strict";var a=s(5893),n=s(7294);t.Z=function(e){let{options:t,coordinates:s,contextMenu:l,setContextMenu:r}=e,c=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=e=>{"context-opener"!==e.target.id&&c.current&&!c.current.contains(e.target)&&r(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);let i=(e,t)=>{e.stopPropagation(),r(!1),t()};return(0,a.jsx)("div",{className:"bg-dropdown-background fixed py-2 z-[100]  shadow-xl",style:{top:s.y,left:s.x},ref:c,children:(0,a.jsx)("ul",{children:t.map(e=>{let{name:t,callback:s}=e;return(0,a.jsx)("li",{onClick:e=>i(e,s),className:"px-5 py-5 cursor-pointer hover:bg-background-default-hover z-[9999]",children:(0,a.jsx)("span",{className:"text-white",children:t})},t)})})})}},2177:function(e,t,s){"use strict";var a=s(5893);s(7294);var n=s(3750);t.Z=function(e){let{messageStatus:t}=e;return(0,a.jsxs)(a.Fragment,{children:["sent"===t&&(0,a.jsx)(n.oFd,{className:"text-lg"}),"delivered"===t&&(0,a.jsx)(n.fC0,{className:"text-lg"}),"read"===t&&(0,a.jsx)(n.fC0,{className:"text-lg text-icon-ack"})]})}},6223:function(e,t,s){"use strict";var a=s(5893);s(7294);var n=s(3935);t.Z=function(e){let{onChange:t}=e,s=(0,a.jsx)("input",{type:"file",id:"photo-picker",onChange:t});return n.createPortal(s,document.getElementById("photo-picker-element"))}},812:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return W}});var a=s(5893),n=s(7294),l=s(9352),r=s(1701),c=s(3750),i=s(9149),o=s(9413),d=s(1163),u=function(){let[{userInfo:e},t]=(0,r.C4)(),s=(0,d.useRouter)(),[u,x]=(0,n.useState)(!1),[m,p]=(0,n.useState)({x:0,y:0}),f=e=>{e.preventDefault(),p({x:e.pageX-50,y:e.pageY+20}),x(!0)};return(0,a.jsxs)("div",{className:"h-16 px-4 py-3 flex justify-between items-center",children:[(0,a.jsx)("div",{className:"cursor-pointer",children:(0,a.jsx)(l.Z,{type:"sm",image:null==e?void 0:e.profileImage})}),(0,a.jsxs)("div",{className:"flex gap-6",children:[(0,a.jsx)(c.Ohv,{className:"text-panel-header-icon cursor-pointer text-xl",title:"New Chat",onClick:()=>{t({type:i.J.SET_ALL_CONTACTS_PAGE})}}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.FQA,{className:"text-panel-header-icon cursor-pointer text-xl",title:"Menu",onClick:e=>f(e),id:"context-opener"}),u&&(0,a.jsx)(o.Z,{options:[{name:"Logout",callback:async()=>{x(!1),s.push("/logout")}}],coordinates:m,contextMenu:u,setContextMenu:x})]})]})]})},x=s(7516),m=function(){let[{contactSearch:e},t]=(0,r.C4)();return(0,a.jsxs)("div",{className:"bg-search-input-container-background flex py-3 pl-5 items-center gap-3 h-14",children:[(0,a.jsxs)("div",{className:"bg-panel-header-background flex items-center gap-5 px-3 py-1 rounded-lg flex-grow",children:[(0,a.jsx)("div",{children:(0,a.jsx)(x.wnI,{className:"text-panel-header-icon cursor-pointer text-lg"})}),(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"text",placeholder:"Search or start a new chat",className:"bg-transparent text-sm focus:outline-none text-white w-full",value:e,onChange:e=>t({type:i.J.SET_CONTACT_SEARCH,contactSearch:e.target.value})})})]}),(0,a.jsx)("div",{className:"pr-5 pl-3",children:(0,a.jsx)(c.r0X,{className:"text-panel-header-icon cursor-pointer text-lg"})})]})},p=s(58),f=s(6154),h=s(157),g=s(2177),j=s(9583),v=function(e){let{data:t,isContactsPage:s=!1}=e,[{userInfo:n,currentChatUser:c},o]=(0,r.C4)();return(0,a.jsxs)("div",{onClick:()=>{s?(o({type:i.J.CHANGE_CURRENT_CHAT_USER,user:{...t}}),o({type:i.J.SET_ALL_CONTACTS_PAGE})):o({type:i.J.CHANGE_CURRENT_CHAT_USER,user:{name:t.name,about:t.about,profilePicture:t.profilePicture,email:t.email,id:n.id===t.senderId?t.receiverId:t.senderId}})},className:"flex cursor-pointer items-center hover:bg-background-default-hover",children:[(0,a.jsx)("div",{className:"min-w-fit px-5 pt-3 pb-1",children:(0,a.jsx)(l.Z,{type:"lg",image:null==t?void 0:t.profilePicture})}),(0,a.jsxs)("div",{className:"min-h-full flex flex-col justify-center mt-3 pr-2 w-full",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsx)("span",{className:"text-white",children:null==t?void 0:t.name})}),!s&&(0,a.jsx)("div",{children:(0,a.jsx)("span",{className:"".concat(t.totalUnreadMessages>0?"text-secondary":"text-icon-green"," text-sm"),children:(0,h.O)(t.createdAt)})})]}),(0,a.jsx)("div",{className:"flex border-b border-conversation-border pb-2 pt-1 pr-2",children:(0,a.jsxs)("div",{className:"flex justify-between w-full",children:[(0,a.jsx)("span",{className:"text-secondary line-clamp-1 text-sm",children:s?(null==t?void 0:t.about)||"\xa0":(0,a.jsxs)("div",{className:"flex items-center gap-1 max-w-[200px] sm:max-w-[250px] md:max-w-[300px] lg:max-w-[200px] xl:max-w-[300px]",children:[t.senderId===n.id&&(0,a.jsx)(g.Z,{messageStatus:t.messageStatus}),"text"===t.type&&(0,a.jsx)("span",{className:"truncate",children:t.message}),"audio"===t.type&&(0,a.jsxs)("span",{className:"flex gap-1 items-center",children:[(0,a.jsx)(j.uYL,{className:"text-panel-header-icon"}),"Audio"]}),"image"===t.type&&(0,a.jsxs)("span",{className:"flex gap-1 items-center",children:[(0,a.jsx)(j.Dmm,{className:"text-panel-header-icon"}),"Image"]})]})}),t.totalUnreadMessages>0&&(0,a.jsx)("span",{className:"bg-icon-green px-[5px] rounded-full text-sm",children:t.totalUnreadMessages})]})})]})]})},N=function(){let[{userInfo:e,userContacts:t,filteredContacts:s},l]=(0,r.C4)();return(0,n.useEffect)(()=>{let t=async()=>{try{let{data:{users:t,onlineUsers:s}}=await (0,f.Z)("".concat(p.yQ,"/").concat(e.id));l({type:i.J.SET_ONLINE_USERS,onlineUsers:s}),l({type:i.J.SET_USER_CONTACTS,userContacts:t})}catch(e){console.log(e)}};(null==e?void 0:e.id)&&t()},[e]),(0,a.jsx)("div",{className:"bg-search-input-container-background flex-auto overflow-auto max-h-full custom-scrollbar ",children:s&&s.length>0?s.map(e=>(0,a.jsx)(v,{data:e},e.id)):t.map(e=>(0,a.jsx)(v,{data:e},e.id))})},b=function(){let[e,t]=(0,n.useState)({}),[s,l]=(0,n.useState)(""),[c,o]=(0,n.useState)([]),[{},d]=(0,r.C4)();return(0,n.useEffect)(()=>{let t=[];Object.values(e).forEach(e=>{let a=e.filter(e=>e.name.toLowerCase().includes(s.toLowerCase()));t.push(...a)}),o(t)},[s,e]),(0,n.useEffect)(()=>{let e=async()=>{try{let e=await f.Z.get(p.To),s=e.data.usersGroupByInitialLetter;t(s)}catch(e){console.log("An error occurred while fetching data:",e)}};e()},[]),(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"h-24 flex items-end px-3 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-12 text-white",children:[(0,a.jsx)(x.YiX,{className:"cursor-pointer text-xl",onClick:()=>{d({type:i.J.SET_ALL_CONTACTS_PAGE})}}),(0,a.jsx)("span",{children:"New Chat"})]})}),(0,a.jsxs)("div",{className:"bg-search-input-container-background h-full flex-auto overflow-auto custom-scrollbar",children:[(0,a.jsx)("div",{className:"flex py-3 items-center gap-3 h-14",children:(0,a.jsxs)("div",{className:"bg-panel-header-background flex items-center gap-5 px-3 py-1 rounded-lg flex-grow mx-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(x.wnI,{className:"text-panel-header-icon cursor-pointer text-lg"})}),(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"text",placeholder:"Search Contacts",className:"bg-transparent text-sm focus:outline-none text-white w-full",value:s,onChange:e=>l(e.target.value)})})]})}),s?c.map(e=>(0,a.jsx)(v,{data:e,isContactsPage:!0},e.id)):Object.entries(e).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-teal-light pl-10 py-5",children:t}),s.map(e=>(0,a.jsx)(v,{data:e,isContactsPage:!0},e.id))]},t)})]})]})},y=function(){let[{contactsPage:e}]=(0,r.C4)(),[t,s]=(0,n.useState)("default");return(0,n.useEffect)(()=>{e?s("all-contacts"):s("default")},[e]),(0,a.jsxs)("div",{className:"bg-panel-header-background flex flex-col max-h-screen z-20",children:["default"===t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{}),(0,a.jsx)(m,{}),(0,a.jsx)(N,{})]}),"all-contacts"===t&&(0,a.jsx)(b,{})]})},w=s(5675),C=s.n(w),E=function(){return(0,a.jsx)("div",{className:"border-conversation-border border-l w-full bg-panel-header-background flex flex-col h-[100vh] border-b-4 border-b-solid border-b-icon-green items-center justify-center",children:(0,a.jsx)(C(),{src:"/whatsapp.gif",alt:"whatsapp",height:300,width:300})})},S=s(1259),k=s(4269),_=s(5434),T=s(155),I=function(){let[{currentChatUser:e,onlineUsers:t},s]=(0,r.C4)(),[d,u]=(0,n.useState)(!1),[m,p]=(0,n.useState)({x:0,y:0}),f=e=>{e.preventDefault(),p({x:e.pageX-50,y:e.pageY+20}),u(!0)};return(0,a.jsxs)("div",{className:"h-16 px-4 py-3 flex justify-between items-center bg-panel-header-background z-50",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,a.jsx)(l.Z,{type:"sm",image:null==e?void 0:e.profilePicture}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"text-primary-strong ",children:[" ",null==e?void 0:e.name," "]}),(0,a.jsx)("span",{className:"text-secondary text-sm",children:t.includes(e.id)?"online":"offline"})]})]}),(0,a.jsxs)("div",{className:"flex gap-6",children:[(0,a.jsx)(_.fFs,{className:"text-panel-header-icon cursor-pointer text-xl",onClick:()=>{s({type:i.J.SET_VOICE_CALL,voiceCall:{...e,type:"out-going",callType:"voice",roomId:Date.now()}})}}),(0,a.jsx)(T.giN,{className:"text-panel-header-icon cursor-pointer text-xl",onClick:()=>{s({type:i.J.SET_VIDEO_CALL,videoCall:{...e,type:"out-going",callType:"video",roomId:Date.now()}})}}),(0,a.jsx)(x.wnI,{className:"text-panel-header-icon cursor-pointer text-xl",onClick:()=>s({type:i.J.SET_MESSAGE_SEARCH})}),(0,a.jsx)(c.FQA,{className:"text-panel-header-icon cursor-pointer text-xl",onClick:e=>f(e),id:"context-opener"}),d&&(0,a.jsx)(o.Z,{options:[{name:"Exit",callback:async()=>{s({type:i.J.SET_EXIT_CHAT})}}],coordinates:m,contextMenu:d,setContextMenu:u})]})]})},A=function(e){let{message:t}=e,[{currentChatUser:s,userInfo:n}]=(0,r.C4)();return(0,a.jsx)("div",{className:"p-1 rounded-lg ".concat(t.senderId===s.id?"bg-incoming-background":"bg-outgoing-background"),children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(C(),{src:"".concat(p.M5,"/").concat(t.message),className:"rounded-lg",alt:"asset",height:300,width:300}),(0,a.jsxs)("div",{className:"absolute bottom-1 right-1 flex items-end gap-1",children:[(0,a.jsx)("span",{className:"text-bubble-meta text-[11px] pt-1 min-w-fit ",children:(0,h.O)(t.createdAt)}),(0,a.jsx)("span",{className:"text-bubble-meta",children:t.senderId===n.id&&(0,a.jsx)(g.Z,{messageStatus:t.messageStatus})})]})]})})},L=s(5152),M=s.n(L);let D=M()(()=>Promise.all([s.e(33),s.e(398)]).then(s.bind(s,2398)),{loadableGenerated:{webpack:()=>[2398]},ssr:!1});var O=function(){let[{messages:e,currentChatUser:t,userInfo:s}]=(0,r.C4)();return(0,a.jsxs)("div",{className:"h-[80vh] w-full relative flex-grow overflow-auto custom-scrollbar",children:[(0,a.jsx)("div",{className:"bg-chat-background bg-fixed h-full w-full opacity-5 fixed left-0 top-0 z-0"}),(0,a.jsx)("div",{className:"mx-10 my-6 relative bottom-0 z-40 left-0",children:(0,a.jsx)("div",{className:"flex w-full",children:(0,a.jsx)("div",{className:"flex flex-col justify-end w-full gap-1 overflow-auto",children:e.map((e,n)=>(0,a.jsxs)("div",{className:"flex ".concat(e.senderId===t.id?"justify-start":"justify-end"),children:["text"===e.type&&(0,a.jsxs)("div",{className:"text-white px-2 py-[5px] text-sm flex gap-2 rounded-md items-end max-w-[45%] ".concat(e.senderId===t.id?"bg-incoming-background":"bg-outgoing-background"),children:[(0,a.jsx)("span",{className:"break-all",children:e.message}),(0,a.jsxs)("div",{className:"flex gap-1 items-end",children:[(0,a.jsx)("span",{className:"text-bubble-meta text-[11px] min-w-fit ",children:(0,h.O)(e.createdAt)}),(0,a.jsx)("span",{children:e.senderId==s.id&&(0,a.jsx)(g.Z,{messageStatus:e.messageStatus})})]})]}),"image"===e.type&&(0,a.jsx)(A,{message:e}),"audio"===e.type&&(0,a.jsx)(D,{message:e})]},e.id))})})})]})},J=s(3048),U=s(3990),R=s(6223);let P=M()(()=>Promise.all([s.e(33),s.e(437)]).then(s.bind(s,437)),{loadableGenerated:{webpack:()=>[437]},ssr:!1});var Z=function(){let[{userInfo:e,currentChatUser:t,socket:s},l]=(0,r.C4)(),[o,d]=(0,n.useState)(""),[u,x]=(0,n.useState)(!1),m=(0,n.useRef)(null),[h,g]=(0,n.useState)(!1),[v,N]=(0,n.useState)(!1),b=async a=>{try{let n=a.target.files[0],r=new FormData;r.append("image",n);let c=await f.Z.post(p.Hj,r,{headers:{"Content-Type":"multipart/form-data"},params:{from:e.id,to:t.id}});201===c.status&&(s.current.emit("send-msg",{to:null==t?void 0:t.id,from:null==e?void 0:e.id,message:c.data.message}),l({type:i.J.ADD_MESSAGE,newMessage:{...c.data.message},fromSelf:!0}))}catch(e){console.log(e)}};(0,n.useEffect)(()=>{let e=e=>{"emoji-open"!==e.target.id&&m.current&&!m.current.contains(e.target)&&x(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);let y=async()=>{try{let{data:a}=await f.Z.post(p.co,{to:null==t?void 0:t.id,from:null==e?void 0:e.id,message:o});s.current.emit("send-msg",{to:null==t?void 0:t.id,from:null==e?void 0:e.id,message:a.message}),l({type:i.J.ADD_MESSAGE,newMessage:{...a.message},fromSelf:!0}),d("")}catch(e){console.log(e)}};return(0,n.useEffect)(()=>{if(h){let e=document.getElementById("photo-picker");e.click(),document.body.onfocus=e=>{setTimeout(()=>{g(!1)},1e3)}}},[h]),(0,a.jsxs)("div",{className:"bg-panel-header-background h-20 px-4 flex items-center gap-6 relative",children:[!v&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-6",children:[(0,a.jsx)(c.yFw,{className:"text-panel-header-icon cursor-pointer text-xl",title:"Emoji",id:"emoji-open",onClick:()=>{x(!u)}}),u&&(0,a.jsx)("div",{className:"absolute bottom-4 left-16 z-40",ref:m,children:(0,a.jsx)(J.ZP,{onEmojiClick:e=>{d(t=>t+=e.emoji)},theme:"dark"})}),(0,a.jsx)(U.M8F,{className:"text-panel-header-icon cursor-pointer text-xl",title:"Attach file",onClick:()=>g(!0)})]}),(0,a.jsx)("div",{className:"w-full rounded-lg h-10 flex items-center",children:(0,a.jsx)("input",{type:"text",placeholder:"Type a message",className:"bg-input-background text-sm focus:outline-none text-white h-10 rounded-lg px-5 py-4 w-full",onChange:e=>d(e.target.value),value:o})}),(0,a.jsx)("div",{className:"flex w-10 items-center justify-center",children:(0,a.jsx)("button",{children:o.length?(0,a.jsx)(_.D6S,{onClick:y,className:"text-panel-header-icon cursor-pointer text-xl",title:"Send Message"}):(0,a.jsx)(j.uYL,{className:"text-panel-header-icon cursor-pointer text-xl",title:"Record",onClick:()=>N(!0)})})})]}),h&&(0,a.jsx)(R.Z,{onChange:b}),v&&(0,a.jsx)(P,{hide:N})]})},G=function(){return(0,a.jsxs)("div",{className:"border-conversation-border border-l w-full bg-conversation-panel-background flex flex-col h-[100vh] z-10",children:[(0,a.jsx)(I,{}),(0,a.jsx)(O,{}),(0,a.jsx)(Z,{})]})},F=s(3920),z=function(){let[{currentChatUser:e,messages:t},s]=(0,r.C4)(),[l,c]=(0,n.useState)(""),[o,d]=(0,n.useState)([]);return(0,n.useEffect)(()=>{l?d(t.filter(e=>"text"===e.type&&e.message.includes(l))):d([])},[l]),(0,a.jsxs)("div",{className:"border-conversation-border border-l w-full bg-conversation-panel-background flex flex-col z-10 max-h-screen",children:[(0,a.jsxs)("div",{className:"h-16 px-4 py-5 flex gap-10 iems-center bg-panel-header-background text-primary-strong",children:[(0,a.jsx)(T.bjh,{className:"cursor-pointer text-icon-lighter text-2xl",onClick:()=>s({type:i.J.SET_MESSAGE_SEARCH})}),(0,a.jsx)("span",{children:"Search Messages"})]}),(0,a.jsxs)("div",{className:"overflow-auto custom-scrollbar h-full",children:[(0,a.jsxs)("div",{className:"flex items-center flex-col w-ful",children:[(0,a.jsx)("div",{className:"flex px-5 items-center gap-3 h-14 w-full",children:(0,a.jsxs)("div",{className:"bg-panel-header-background flex items-center gap-5 px-3 py-1 rounded-lg flex-grow",children:[(0,a.jsx)("div",{children:(0,a.jsx)(x.wnI,{className:"text-panel-header-icon cursor-pointer text-lg"})}),(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"text",placeholder:"Search Messages",className:"bg-transparent text-sm focus:outline-none text-white w-full",value:l,onChange:e=>c(e.target.value)})})]})}),(0,a.jsx)("span",{className:"mt-10 text-secondary",children:!l.length&&"Search for messages with ".concat(e.name)})]}),(0,a.jsxs)("div",{className:"flex justify-center h-full flex-col",children:[l.length>0&&!o.length&&(0,a.jsx)("span",{className:"text-secondary w-full flex justify-center",children:"No Messages found"}),(0,a.jsx)("div",{className:"flex flex-col w-full h-full",children:o.map(e=>(0,a.jsxs)("div",{className:"flex cursor-pointer flex-col justify-center hover:bg-background-default-hover w-full px-5 border-b-[0.1px] border-secondary py-5",children:[(0,a.jsx)("div",{className:"text-sm text-secondary",children:(0,h.O)(e.createdAt)}),(0,a.jsx)("div",{className:"text-icon-green",children:e.message})]}))})]})]})]})};let V=M()(()=>s.e(8).then(s.bind(s,8)),{loadableGenerated:{webpack:()=>[8]},ssr:!1});var Y=function(){let[{videoCall:e,socket:t,userInfo:s}]=(0,r.C4)();return(0,n.useEffect)(()=>{"out-going"===e.type&&t.current.emit("outgoing-video-call",{to:e.id,from:{id:s.id,profilePicture:s.profileImage,name:s.name},callType:e.callType,roomId:e.roomId})},[e]),(0,a.jsx)(V,{data:e})};let H=M()(()=>s.e(8).then(s.bind(s,8)),{loadableGenerated:{webpack:()=>[8]},ssr:!1});var X=function(){let[{voiceCall:e,socket:t,userInfo:s}]=(0,r.C4)();return(0,n.useEffect)(()=>{"out-going"===e.type&&t.current.emit("outgoing-voice-call",{to:e.id,from:{id:s.id,profilePicture:s.profileImage,name:s.name},callType:e.callType,roomId:e.roomId})},[e]),(0,a.jsx)(H,{data:e})},B=function(){let[{incomingVideoCall:e,socket:t},s]=(0,r.C4)();return(0,a.jsxs)("div",{className:"h-24 w-80 fixed bottom-8 mb-0 right-6 z-50 rounded-sm flex gap-5 items-center justify-start p-4 bg-conversation-panel-background text-white drop-shadow-2xl border-icon-green border-2 py-14 ",children:[(0,a.jsx)("div",{children:(0,a.jsx)(C(),{src:e.profilePicture,alt:"avatar",width:70,height:70,className:"rounded-full"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:e.name}),(0,a.jsx)("div",{className:"text-xs",children:"Incoming Video Call"}),(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,a.jsx)("button",{className:"bg-red-500 p-1 px-3 text-sm rounded-full",onClick:()=>{t.current.emit("reject-video-call",{from:e.id}),s({type:i.J.END_CALL})},children:"Reject"}),(0,a.jsx)("button",{className:"bg-green-500 p-1 px-3 text-sm rounded-full",onClick:()=>{s({type:i.J.SET_VIDEO_CALL,videoCall:{...e,type:"in-coming"}}),t.current.emit("accept-incoming-call",{id:e.id}),s({type:i.J.SET_INCOMING_VIDEO_CALL,incomingVideoCall:void 0})},children:"Accept"})]})]})]})},K=function(){let[{incomingVoiceCall:e,socket:t},s]=(0,r.C4)();return(0,a.jsxs)("div",{className:"h-24 w-80 fixed bottom-8 mb-0 right-6 z-50 rounded-sm flex gap-5 items-center justify-start p-4 bg-conversation-panel-background text-white drop-shadow-2xl border-icon-green border-2 py-14 ",children:[(0,a.jsx)("div",{children:(0,a.jsx)(C(),{src:e.profilePicture,alt:"avatar",width:70,height:70,className:"rounded-full"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:e.name}),(0,a.jsx)("div",{className:"text-xs",children:"Incoming VOice Call"}),(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,a.jsx)("button",{className:"bg-red-500 p-1 px-3 text-sm rounded-full",onClick:()=>{t.current.emit("reject-voice-call",{from:e.id}),s({type:i.J.END_CALL})},children:"Reject"}),(0,a.jsx)("button",{className:"bg-green-500 p-1 px-3 text-sm rounded-full",onClick:()=>{s({type:i.J.SET_VOICE_CALL,voiceCall:{...e,type:"in-coming"}}),t.current.emit("accept-incoming-call",{id:e.id}),s({type:i.J.SET_INCOMING_VOICE_CALL,incomingVoiceCall:void 0})},children:"Accept"})]})]})]})},Q=function(){let e=(0,d.useRouter)(),[{userInfo:t,currentChatUser:s,messagesSearch:l,videoCall:c,voiceCall:o,incomingVoiceCall:u,incomingVideoCall:x},m]=(0,r.C4)(),[h,g]=(0,n.useState)(!1),[j,v]=(0,n.useState)(!1),N=(0,n.useRef)();return(0,n.useEffect)(()=>{h&&e.push("/login")},[h]),(0,S.Aj)(k.l,async s=>{if(s||g(!0),!t&&(null==s?void 0:s.email)){let{data:t}=await f.Z.post(p.gS,{email:s.email});if(t.status||e.push("/login"),null==t?void 0:t.data){let{id:e,name:s,email:a,profilePicture:n,status:l}=t.data;m({type:i.J.SET_USER_INFO,userInfo:{id:e,name:s,email:a,profileImage:n,status:l}})}}}),(0,n.useEffect)(()=>{t&&(N.current=(0,F.io)(p.M5),N.current.emit("add-user",t.id),m({type:i.J.SET_SOCKET,socket:N}))},[t]),(0,n.useEffect)(()=>{N.current&&!j&&(N.current.on("msg-recieve",e=>{m({type:i.J.ADD_MESSAGE,newMessage:{...e.message}})}),N.current.on("incoming-voice-call",e=>{let{from:t,roomId:s,callType:a}=e;m({type:i.J.SET_INCOMING_VOICE_CALL,incomingVoiceCall:{...t,roomId:s,callType:a}})}),N.current.on("incoming-video-call",e=>{let{from:t,roomId:s,callType:a}=e;m({type:i.J.SET_INCOMING_VIDEO_CALL,incomingVideoCall:{...t,roomId:s,callType:a}})}),N.current.on("voice-call-rejected",()=>{m({type:i.J.END_CALL})}),N.current.on("video-call-rejected",()=>{m({type:i.J.END_CALL})}),N.current.on("online-users",e=>{let{onlineUsers:t}=e;m({type:i.J.SET_ONLINE_USERS,onlineUsers:t})}),v(!0))},[N.current]),(0,n.useEffect)(()=>{let e=async()=>{let{data:{messages:e}}=await f.Z.get("".concat(p.Ru,"/").concat(t.id,"/").concat(s.id));m({type:i.J.SET_MESSAGES,messages:e})};(null==s?void 0:s.id)&&e()},[s]),(0,a.jsxs)(a.Fragment,{children:[x&&(0,a.jsx)(B,{}),u&&(0,a.jsx)(K,{}),c&&(0,a.jsx)("div",{className:"h-screen w-screen max-h-full overflow-hidden",children:(0,a.jsx)(Y,{})}),o&&(0,a.jsx)("div",{className:"h-screen w-screen max-h-full overflow-hidden",children:(0,a.jsx)(X,{})}),!c&&!o&&(0,a.jsxs)("div",{className:"grid grid-cols-main h-screen w-screen max-h-screen max-w-full overflow-hidden ",children:[(0,a.jsx)(y,{}),s?(0,a.jsxs)("div",{className:l?"grid grid-cols-2":"grid-cols-2",children:[(0,a.jsx)(G,{}),l&&(0,a.jsx)(z,{})]}):(0,a.jsx)(E,{})]})]})},W=function(){return(0,a.jsx)(Q,{})}},58:function(e,t,s){"use strict";s.d(t,{Hj:function(){return x},M5:function(){return a},MZ:function(){return o},OZ:function(){return m},Ru:function(){return u},To:function(){return i},co:function(){return d},gS:function(){return r},p0:function(){return c},yQ:function(){return p}});let a="http://localhost:3005",n="".concat(a,"/api/auth"),l="".concat(a,"/api/messages"),r="".concat(n,"/check-user"),c="".concat(n,"/onboard-user"),i="".concat(n,"/get-contacts"),o="".concat(n,"/generate-token"),d="".concat(l,"/add-message"),u="".concat(l,"/get-messages"),x="".concat(l,"/add-image-message"),m="".concat(l,"/add-audio-message"),p="".concat(l,"/get-initial-contacts")},157:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});let a=e=>{let t=new Date(e),s=new Date;if(t.getUTCDate()===s.getUTCDate()&&t.getUTCMonth()===s.getUTCMonth()&&t.getUTCFullYear()===s.getUTCFullYear()){let e=t.toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric"});return e}if(t.getUTCDate()===s.getUTCDate()-1&&t.getUTCMonth()===s.getUTCMonth()&&t.getUTCFullYear()===s.getUTCFullYear())return"Yesterday";if(Math.floor((s-t)/864e5)>1&&7>=Math.floor((s-t)/864e5)){let e=new Date;e.setDate(s.getDate()-Math.floor((s-t)/864e5));let a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()];return a}{let e=t.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"});return e}}},4269:function(e,t,s){"use strict";s.d(t,{l:function(){return r}});var a=s(3977),n=s(1259);let l=(0,a.ZF)({apiKey:"AIzaSyDUSZ6qp7rNVgaKgMKXTtKzG1mrPIWyaTg",authDomain:"whatsapp-clone-35f2d.firebaseapp.com",projectId:"whatsapp-clone-35f2d",storageBucket:"whatsapp-clone-35f2d.appspot.com",messagingSenderId:"114535616495",appId:"1:114535616495:web:07473668f9dd7f71c0301a",measurementId:"G-2LQ61SYFW5"}),r=(0,n.v0)(l)}},function(e){e.O(0,[551,445,260,228,609,13,874,307,772,354,964,774,888,179],function(){return e(e.s=5728)}),_N_E=e.O()}]);